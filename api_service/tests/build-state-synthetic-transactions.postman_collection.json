{
  "info": {
    "name": "Build State API Synthetic Transactions",
    "description": "Synthetic transaction tests simulating real-world API usage patterns",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userTokens",
      "value": "[]",
      "type": "string"
    },
    {
      "key": "buildIds",
      "value": "[]",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Setup - Admin Authentication",
      "item": [
        {
          "name": "Admin Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "password"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Admin login successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.access_token).to.be.a('string');",
                  "    pm.collectionVariables.set(\"adminToken\", jsonData.access_token);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Synthetic Transaction 1: User Onboarding Flow",
      "item": [
        {
          "name": "Create Developer User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"dev.user\",\n  \"email\": \"dev.user@company.com\",\n  \"first_name\": \"Dev\",\n  \"last_name\": \"User\",\n  \"employee_id\": \"DEV001\",\n  \"password\": \"devpass123\",\n  \"is_superuser\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["users"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"User created successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Store user ID for later use",
                  "var jsonData = pm.response.json();",
                  "pm.collectionVariables.set(\"devUserId\", jsonData.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Create API Token for Developer",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Dev API Token\",\n  \"scopes\": [\"read\", \"write\", \"build\"],\n  \"expires_at\": null\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{devUserId}}/tokens",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{devUserId}}", "tokens"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"API token created\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Developer Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"dev.user\",\n  \"password\": \"devpass123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "password"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Developer login successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set(\"devToken\", jsonData.access_token);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Synthetic Transaction 2: Build Pipeline Flow",
      "item": [
        {
          "name": "Start New Build",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"platform\": \"aws-commercial\",\n  \"os_version\": \"rhel-8.8\",\n  \"image_type\": \"base\",\n  \"build_id\": \"pipeline-build-\" + Date.now(),\n  \"pipeline_url\": \"https://github.com/company/repo/actions/runs/\" + Math.floor(Math.random() * 10000),\n  \"commit_hash\": \"abc\" + Math.random().toString(36).substring(2, 8)\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds",
              "host": ["{{baseUrl}}"],
              "path": ["builds"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Build created\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "pm.collectionVariables.set(\"pipelineBuildId\", jsonData.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Build - Validation Phase",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"state_code\": 10,\n  \"message\": \"Starting validation phase\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds/{{pipelineBuildId}}/state",
              "host": ["{{baseUrl}}"],
              "path": ["builds", "{{pipelineBuildId}}", "state"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Build state updated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Build - Build Phase",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"state_code\": 25,\n  \"message\": \"Build phase in progress\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds/{{pipelineBuildId}}/state",
              "host": ["{{baseUrl}}"],
              "path": ["builds", "{{pipelineBuildId}}", "state"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Build state updated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Build - Testing Phase",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"state_code\": 50,\n  \"message\": \"Running test suite\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds/{{pipelineBuildId}}/state",
              "host": ["{{baseUrl}}"],
              "path": ["builds", "{{pipelineBuildId}}", "state"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Build state updated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Build - Deployment Phase",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"state_code\": 75,\n  \"message\": \"Deploying to staging\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds/{{pipelineBuildId}}/state",
              "host": ["{{baseUrl}}"],
              "path": ["builds", "{{pipelineBuildId}}", "state"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Build state updated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Complete Build Successfully",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"state_code\": 100,\n  \"message\": \"Build completed successfully\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds/{{pipelineBuildId}}/state",
              "host": ["{{baseUrl}}"],
              "path": ["builds", "{{pipelineBuildId}}", "state"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Build completed\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Synthetic Transaction 3: Failed Build Scenario",
      "item": [
        {
          "name": "Start Failed Build",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"platform\": \"aws-commercial\",\n  \"os_version\": \"rhel-8.8\",\n  \"image_type\": \"base\",\n  \"build_id\": \"failed-build-\" + Date.now(),\n  \"pipeline_url\": \"https://github.com/company/repo/actions/runs/\" + Math.floor(Math.random() * 10000),\n  \"commit_hash\": \"def\" + Math.random().toString(36).substring(2, 8)\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds",
              "host": ["{{baseUrl}}"],
              "path": ["builds"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Failed build created\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "pm.collectionVariables.set(\"failedBuildId\", jsonData.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "Update Build - Starting",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"state_code\": 10,\n  \"message\": \"Build started\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds/{{failedBuildId}}/state",
              "host": ["{{baseUrl}}"],
              "path": ["builds", "{{failedBuildId}}", "state"]
            }
          }
        },
        {
          "name": "Record Build Failure",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{devToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"error_message\": \"Unit tests failed\",\n  \"error_code\": \"TEST_FAILURE\",\n  \"component\": \"test\",\n  \"details\": {\n    \"failed_tests\": 3,\n    \"total_tests\": 150,\n    \"failure_reason\": \"AssertionError in authentication module\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/builds/{{failedBuildId}}/failure",
              "host": ["{{baseUrl}}"],
              "path": ["builds", "{{failedBuildId}}", "failure"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Build failure recorded\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Synthetic Transaction 4: Dashboard Monitoring",
      "item": [
        {
          "name": "Get Dashboard Summary",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/dashboard/summary",
              "host": ["{{baseUrl}}"],
              "path": ["dashboard", "summary"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Dashboard accessible\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Dashboard has expected structure\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.total_builds).to.be.at.least(2);",
                  "    pm.expect(jsonData.status_counts).to.be.an('object');",
                  "    pm.expect(jsonData.recent_builds).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Synthetic Transaction 5: User Deactivation Flow",
      "item": [
        {
          "name": "Deactivate Developer User",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"is_active\": false,\n  \"deactivated_at\": \"2024-01-15T10:00:00Z\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{devUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{devUserId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"User deactivated\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify User Profile Still Accessible",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/{{devUserId}}/profile",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{devUserId}}", "profile"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Deactivated user profile accessible\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Profile shows deactivated status\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.is_active).to.be.false;",
                  "    pm.expect(jsonData.deactivated_at).to.not.be.null;",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}