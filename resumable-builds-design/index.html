
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the State-Based Build Framework - resumable, state-based CI/CD pipelines for multi-cloud IaaS image creation">
      
      
        <meta name="author" content="Scott Smith">
      
      
        <link rel="canonical" href="https://VirtuallyScott.github.io/state-builds/resumable-builds-design/">
      
      
        <link rel="prev" href="../resumable-builds-quickstart/">
      
      
        <link rel="next" href="../artifact-storage/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.2">
    
    
      
        <title>Resumable Builds Design - State-Based Build Framework</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d7758b05.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#resumable-build-system-design-document" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="State-Based Build Framework" class="md-header__button md-logo" aria-label="State-Based Build Framework" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            State-Based Build Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Resumable Builds Design
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/VirtuallyScott/state-builds" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    VirtuallyScott/state-builds
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="State-Based Build Framework" class="md-nav__button md-logo" aria-label="State-Based Build Framework" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    State-Based Build Framework
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/VirtuallyScott/state-builds" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    VirtuallyScott/state-builds
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../problem-statement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problem Statement
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../database-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Pipeline Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resumable-builds-quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resumable Builds Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Design & Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Design & Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Resumable Builds Design
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Resumable Builds Design
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      üìã Executive Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Problem Statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ Problem Statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-challenges" class="md-nav__link">
    <span class="md-ellipsis">
      Current Challenges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-example" class="md-nav__link">
    <span class="md-ellipsis">
      Use Case Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      üèóÔ∏è Architecture Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üèóÔ∏è Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-components" class="md-nav__link">
    <span class="md-ellipsis">
      High-Level Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-design" class="md-nav__link">
    <span class="md-ellipsis">
      üìä Database Schema Design
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìä Database Schema Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-tables" class="md-nav__link">
    <span class="md-ellipsis">
      New Tables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="New Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-build_artifacts-table" class="md-nav__link">
    <span class="md-ellipsis">
      1. build_artifacts Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-build_variables-table" class="md-nav__link">
    <span class="md-ellipsis">
      2. build_variables Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-resumable_states-table" class="md-nav__link">
    <span class="md-ellipsis">
      3. resumable_states Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-resume_requests-table" class="md-nav__link">
    <span class="md-ellipsis">
      4. resume_requests Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-build_jobs-table" class="md-nav__link">
    <span class="md-ellipsis">
      5. build_jobs Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-relationships" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Relationships
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-workflow-with-resumability" class="md-nav__link">
    <span class="md-ellipsis">
      üîÑ Build Workflow with Resumability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîÑ Build Workflow with Resumability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#normal-build-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Normal Build Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-failure-and-resume-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Build Failure and Resume Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#artifact-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Artifact Lifecycle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      üîå API Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîå API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artifact-management" class="md-nav__link">
    <span class="md-ellipsis">
      Artifact Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Artifact Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-buildsbuild_idartifacts" class="md-nav__link">
    <span class="md-ellipsis">
      POST /builds/{build_id}/artifacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idartifacts" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/artifacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idartifactsartifact_id" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/artifacts/{artifact_id}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-buildsbuild_idartifactsartifact_id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /builds/{build_id}/artifacts/{artifact_id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-management" class="md-nav__link">
    <span class="md-ellipsis">
      Variable Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variable Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-buildsbuild_idvariables" class="md-nav__link">
    <span class="md-ellipsis">
      POST /builds/{build_id}/variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idvariables" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-buildsbuild_idvariableskey" class="md-nav__link">
    <span class="md-ellipsis">
      PATCH /builds/{build_id}/variables/{key}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-buildsbuild_idvariableskey" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /builds/{build_id}/variables/{key}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resume-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Resume Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resume Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-buildsbuild_idresume" class="md-nav__link">
    <span class="md-ellipsis">
      POST /builds/{build_id}/resume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idresume-context" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/resume-context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idresume-requests" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/resume-requests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-resume-requestsrequest_id" class="md-nav__link">
    <span class="md-ellipsis">
      GET /resume-requests/{request_id}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-resume-requestsrequest_id" class="md-nav__link">
    <span class="md-ellipsis">
      PATCH /resume-requests/{request_id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resumable-state-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Resumable State Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resumable State Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-projectsproject_idresumable-states" class="md-nav__link">
    <span class="md-ellipsis">
      POST /projects/{project_id}/resumable-states
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-projectsproject_idresumable-states" class="md-nav__link">
    <span class="md-ellipsis">
      GET /projects/{project_id}/resumable-states
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-projectsproject_idresumable-statesstate_code" class="md-nav__link">
    <span class="md-ellipsis">
      GET /projects/{project_id}/resumable-states/{state_code}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-projectsproject_idresumable-statesstate_code" class="md-nav__link">
    <span class="md-ellipsis">
      PUT /projects/{project_id}/resumable-states/{state_code}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-commands" class="md-nav__link">
    <span class="md-ellipsis">
      üéÆ CLI Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéÆ CLI Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artifact-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Artifact Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Variable Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resume-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Resume Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resumable-state-configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      Resumable State Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#orchestrator-service" class="md-nav__link">
    <span class="md-ellipsis">
      ü§ñ Orchestrator Service
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ü§ñ Orchestrator Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orchestrator-components" class="md-nav__link">
    <span class="md-ellipsis">
      Orchestrator Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Orchestrator Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-webhook-handler" class="md-nav__link">
    <span class="md-ellipsis">
      1. Webhook Handler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-resume-queue" class="md-nav__link">
    <span class="md-ellipsis">
      2. Resume Queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-job-trigger" class="md-nav__link">
    <span class="md-ellipsis">
      3. Job Trigger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-status-monitor" class="md-nav__link">
    <span class="md-ellipsis">
      4. Status Monitor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orchestrator-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Orchestrator Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-script-integration" class="md-nav__link">
    <span class="md-ellipsis">
      üìù Build Script Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìù Build Script Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-build-with-artifact-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Build (with artifact tracking)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resume-build-script" class="md-nav__link">
    <span class="md-ellipsis">
      Resume Build Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-phases" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Implementation Phases
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ Implementation Phases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-database-core-api-week-1-2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1: Database &amp; Core API (Week 1-2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-cli-integration-week-2-3" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: CLI Integration (Week 2-3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-resume-api-week-3-4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3: Resume API (Week 3-4)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-orchestrator-service-week-4-6" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 4: Orchestrator Service (Week 4-6)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-example-scripts-documentation-week-6-7" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 5: Example Scripts &amp; Documentation (Week 6-7)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-production-hardening-week-7-8" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 6: Production Hardening (Week 7-8)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      üîç Example Scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîç Example Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-network-timeout-during-package-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 1: Network Timeout During Package Installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-configuration-error-at-state-60" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 2: Configuration Error at State 60
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-quota-limit-during-ami-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 3: Quota Limit During AMI Registration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      üìà Success Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìà Success Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metrics-to-track" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics to Track
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-metrics-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      API Metrics Endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-decisions-trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      ü§î Design Decisions &amp; Trade-offs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ü§î Design Decisions & Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-artifact-storage-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      1. Artifact Storage Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-state-granularity" class="md-nav__link">
    <span class="md-ellipsis">
      2. State Granularity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-orchestrator-as-separate-service" class="md-nav__link">
    <span class="md-ellipsis">
      3. Orchestrator as Separate Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-checksum-verification" class="md-nav__link">
    <span class="md-ellipsis">
      4. Checksum Verification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-variable-storage" class="md-nav__link">
    <span class="md-ellipsis">
      5. Variable Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      üöÄ Next Steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      üìö References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../artifact-storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifact Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    CLI Tool
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            CLI Tool
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Service
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Service
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/api-reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      üìã Executive Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Problem Statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ Problem Statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-challenges" class="md-nav__link">
    <span class="md-ellipsis">
      Current Challenges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-case-example" class="md-nav__link">
    <span class="md-ellipsis">
      Use Case Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      üèóÔ∏è Architecture Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üèóÔ∏è Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-components" class="md-nav__link">
    <span class="md-ellipsis">
      High-Level Components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-design" class="md-nav__link">
    <span class="md-ellipsis">
      üìä Database Schema Design
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìä Database Schema Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-tables" class="md-nav__link">
    <span class="md-ellipsis">
      New Tables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="New Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-build_artifacts-table" class="md-nav__link">
    <span class="md-ellipsis">
      1. build_artifacts Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-build_variables-table" class="md-nav__link">
    <span class="md-ellipsis">
      2. build_variables Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-resumable_states-table" class="md-nav__link">
    <span class="md-ellipsis">
      3. resumable_states Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-resume_requests-table" class="md-nav__link">
    <span class="md-ellipsis">
      4. resume_requests Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-build_jobs-table" class="md-nav__link">
    <span class="md-ellipsis">
      5. build_jobs Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-relationships" class="md-nav__link">
    <span class="md-ellipsis">
      Schema Relationships
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-workflow-with-resumability" class="md-nav__link">
    <span class="md-ellipsis">
      üîÑ Build Workflow with Resumability
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîÑ Build Workflow with Resumability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#normal-build-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Normal Build Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-failure-and-resume-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Build Failure and Resume Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#artifact-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Artifact Lifecycle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      üîå API Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîå API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artifact-management" class="md-nav__link">
    <span class="md-ellipsis">
      Artifact Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Artifact Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-buildsbuild_idartifacts" class="md-nav__link">
    <span class="md-ellipsis">
      POST /builds/{build_id}/artifacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idartifacts" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/artifacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idartifactsartifact_id" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/artifacts/{artifact_id}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-buildsbuild_idartifactsartifact_id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /builds/{build_id}/artifacts/{artifact_id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-management" class="md-nav__link">
    <span class="md-ellipsis">
      Variable Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Variable Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-buildsbuild_idvariables" class="md-nav__link">
    <span class="md-ellipsis">
      POST /builds/{build_id}/variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idvariables" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-buildsbuild_idvariableskey" class="md-nav__link">
    <span class="md-ellipsis">
      PATCH /builds/{build_id}/variables/{key}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-buildsbuild_idvariableskey" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /builds/{build_id}/variables/{key}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resume-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Resume Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resume Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-buildsbuild_idresume" class="md-nav__link">
    <span class="md-ellipsis">
      POST /builds/{build_id}/resume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idresume-context" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/resume-context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-buildsbuild_idresume-requests" class="md-nav__link">
    <span class="md-ellipsis">
      GET /builds/{build_id}/resume-requests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-resume-requestsrequest_id" class="md-nav__link">
    <span class="md-ellipsis">
      GET /resume-requests/{request_id}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-resume-requestsrequest_id" class="md-nav__link">
    <span class="md-ellipsis">
      PATCH /resume-requests/{request_id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resumable-state-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Resumable State Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resumable State Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-projectsproject_idresumable-states" class="md-nav__link">
    <span class="md-ellipsis">
      POST /projects/{project_id}/resumable-states
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-projectsproject_idresumable-states" class="md-nav__link">
    <span class="md-ellipsis">
      GET /projects/{project_id}/resumable-states
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-projectsproject_idresumable-statesstate_code" class="md-nav__link">
    <span class="md-ellipsis">
      GET /projects/{project_id}/resumable-states/{state_code}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-projectsproject_idresumable-statesstate_code" class="md-nav__link">
    <span class="md-ellipsis">
      PUT /projects/{project_id}/resumable-states/{state_code}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-commands" class="md-nav__link">
    <span class="md-ellipsis">
      üéÆ CLI Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéÆ CLI Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artifact-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Artifact Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Variable Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resume-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Resume Commands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resumable-state-configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      Resumable State Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#orchestrator-service" class="md-nav__link">
    <span class="md-ellipsis">
      ü§ñ Orchestrator Service
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ü§ñ Orchestrator Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orchestrator-components" class="md-nav__link">
    <span class="md-ellipsis">
      Orchestrator Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Orchestrator Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-webhook-handler" class="md-nav__link">
    <span class="md-ellipsis">
      1. Webhook Handler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-resume-queue" class="md-nav__link">
    <span class="md-ellipsis">
      2. Resume Queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-job-trigger" class="md-nav__link">
    <span class="md-ellipsis">
      3. Job Trigger
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-status-monitor" class="md-nav__link">
    <span class="md-ellipsis">
      4. Status Monitor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orchestrator-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Orchestrator Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-script-integration" class="md-nav__link">
    <span class="md-ellipsis">
      üìù Build Script Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìù Build Script Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-build-with-artifact-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Build (with artifact tracking)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resume-build-script" class="md-nav__link">
    <span class="md-ellipsis">
      Resume Build Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-phases" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Implementation Phases
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ Implementation Phases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-database-core-api-week-1-2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1: Database &amp; Core API (Week 1-2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-cli-integration-week-2-3" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2: CLI Integration (Week 2-3)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-resume-api-week-3-4" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3: Resume API (Week 3-4)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-orchestrator-service-week-4-6" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 4: Orchestrator Service (Week 4-6)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-example-scripts-documentation-week-6-7" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 5: Example Scripts &amp; Documentation (Week 6-7)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-production-hardening-week-7-8" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 6: Production Hardening (Week 7-8)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      üîç Example Scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîç Example Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scenario-1-network-timeout-during-package-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 1: Network Timeout During Package Installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-2-configuration-error-at-state-60" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 2: Configuration Error at State 60
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scenario-3-quota-limit-during-ami-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Scenario 3: Quota Limit During AMI Registration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      üìà Success Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìà Success Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metrics-to-track" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics to Track
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-metrics-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      API Metrics Endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-decisions-trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      ü§î Design Decisions &amp; Trade-offs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ü§î Design Decisions & Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-artifact-storage-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      1. Artifact Storage Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-state-granularity" class="md-nav__link">
    <span class="md-ellipsis">
      2. State Granularity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-orchestrator-as-separate-service" class="md-nav__link">
    <span class="md-ellipsis">
      3. Orchestrator as Separate Service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-checksum-verification" class="md-nav__link">
    <span class="md-ellipsis">
      4. Checksum Verification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-variable-storage" class="md-nav__link">
    <span class="md-ellipsis">
      5. Variable Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      üöÄ Next Steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      üìö References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="resumable-build-system-design-document">Resumable Build System - Design Document<a class="headerlink" href="#resumable-build-system-design-document" title="Permanent link">&para;</a></h1>
<h2 id="executive-summary">üìã Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">&para;</a></h2>
<p>This document outlines the design for a resumable build system that enables long-running IaaS VM image builds to recover from failures without restarting from scratch. The system tracks build artifacts, state progression, and provides orchestration capabilities to resume builds from the last successful state.</p>
<h2 id="problem-statement">üéØ Problem Statement<a class="headerlink" href="#problem-statement" title="Permanent link">&para;</a></h2>
<h3 id="current-challenges">Current Challenges<a class="headerlink" href="#current-challenges" title="Permanent link">&para;</a></h3>
<p><strong>Long-Running Monolithic Builds:</strong>
- VM image builds can take 1+ hours to complete
- A single failure means restarting the entire process
- Network issues, quota limits, or transient errors waste hours
- No visibility into which artifacts were successfully created</p>
<p><strong>Artifacts Without Context:</strong>
- Intermediate VM snapshots are created but not tracked
- Build scripts don't know what artifacts exist from previous runs
- Manual intervention required to resume builds
- Risk of artifact corruption or confusion</p>
<h3 id="use-case-example">Use Case Example<a class="headerlink" href="#use-case-example" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Build Pipeline: RHEL 9 Base Image for AWS
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Total Time: ~75 minutes
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>State 0:  Pending (0 min)
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>State 5:  Validate configuration (2 min)
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>State 10: Create base VM (5 min)
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>State 15: Security hardening (8 min)
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>State 20: Install packages (15 min)  ‚Üê FAILS HERE (network timeout)
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>State 25: Configure services (10 min)
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>State 30: Install monitoring (8 min)
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>State 35: Run tests (12 min)
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>State 40: Create snapshot (10 min)
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>State 45: Register AMI (5 min)
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>State 100: Complete
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>Without resumability: Start over, waste 30 minutes
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>With resumability: Resume from State 20, waste 0 minutes
</span></code></pre></div>
<h2 id="architecture-overview">üèóÔ∏è Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">&para;</a></h2>
<h3 id="high-level-components">High-Level Components<a class="headerlink" href="#high-level-components" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph TB
    subgraph "CI/CD Platform"
        A[Concourse/Jenkins Job]
        B[Build Script]
        C[CLI Tool]
    end

    subgraph "Build State API"
        D[REST API]
        E[Database]
        F[Artifact Registry]
    end

    subgraph "Orchestrator"
        G[Resume Orchestrator]
        H[Webhook Handler]
        I[Job Trigger]
    end

    subgraph "Storage Backends"
        J[AWS S3]
        K[Azure Blob]
        L[GCP Storage]
        M[Local Disk]
    end

    A --&gt; B
    B --&gt; C
    C --&gt; D
    D --&gt; E
    D --&gt; F
    F --&gt; J
    F --&gt; K
    F --&gt; L
    F --&gt; M

    A -.-&gt;|failure| H
    H --&gt; G
    G --&gt; I
    I -.-&gt;|resume| A

    style G fill:#f9f,stroke:#333
    style F fill:#bbf,stroke:#333
    style E fill:#bfb,stroke:#333</code></pre>
<h2 id="database-schema-design">üìä Database Schema Design<a class="headerlink" href="#database-schema-design" title="Permanent link">&para;</a></h2>
<h3 id="new-tables">New Tables<a class="headerlink" href="#new-tables" title="Permanent link">&para;</a></h3>
<h4 id="1-build_artifacts-table">1. <code>build_artifacts</code> Table<a class="headerlink" href="#1-build_artifacts-table" title="Permanent link">&para;</a></h4>
<p>Tracks all artifacts created during a build, with their storage locations and checksums.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">build_artifacts</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="n">build_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">builds</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="n">state_code</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="c1">-- Artifact identification</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="n">artifact_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="n">artifact_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="c1">-- &#39;vm_snapshot&#39;, &#39;ami&#39;, &#39;disk_image&#39;, &#39;config_file&#39;, etc.</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="n">artifact_path</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">         </span><span class="c1">-- Full path/URL to artifact</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="c1">-- Storage details</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="n">storage_backend</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="c1">-- &#39;s3&#39;, &#39;azure_blob&#39;, &#39;gcp_storage&#39;, &#39;local&#39;, &#39;vsphere&#39;</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="n">storage_region</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="n">storage_bucket</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="n">storage_key</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                     </span><span class="c1">-- Key/path within bucket</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span><span class="c1">-- Artifact metadata</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">    </span><span class="n">size_bytes</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="n">checksum</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span><span class="w">                 </span><span class="c1">-- SHA256 checksum</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">    </span><span class="n">checksum_algorithm</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span><span class="c1">-- Artifact lifecycle</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span><span class="n">is_resumable</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">TRUE</span><span class="p">,</span><span class="w">    </span><span class="c1">-- Can this artifact be used to resume?</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="n">is_final</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span><span class="w">       </span><span class="c1">-- Is this the final deliverable?</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">    </span><span class="n">expires_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- When to clean up temporary artifacts</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span><span class="c1">-- Additional metadata as JSON</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w">                       </span><span class="c1">-- VM ID, snapshot ID, AMI ID, etc.</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span><span class="n">deleted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span><span class="w">                 </span><span class="c1">-- Soft delete for audit</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">build_id</span><span class="p">,</span><span class="w"> </span><span class="n">artifact_name</span><span class="p">)</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="p">);</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_artifacts_build_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_artifacts</span><span class="p">(</span><span class="n">build_id</span><span class="p">);</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_artifacts_state_code</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_artifacts</span><span class="p">(</span><span class="n">state_code</span><span class="p">);</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_artifacts_type</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_artifacts</span><span class="p">(</span><span class="n">artifact_type</span><span class="p">);</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_artifacts_resumable</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_artifacts</span><span class="p">(</span><span class="n">is_resumable</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">is_resumable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="p">;</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_artifacts_expires</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_artifacts</span><span class="p">(</span><span class="n">expires_at</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">expires_at</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="2-build_variables-table">2. <code>build_variables</code> Table<a class="headerlink" href="#2-build_variables-table" title="Permanent link">&para;</a></h4>
<p>Stores build-specific variables needed for resumption (VM IDs, network config, etc.).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">build_variables</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">build_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">builds</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="c1">-- Variable details</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">variable_key</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="n">variable_value</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="n">variable_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- &#39;string&#39;, &#39;json&#39;, &#39;encrypted&#39;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="c1">-- When was this variable set?</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="n">set_at_state</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w">                </span><span class="c1">-- Which state code set this variable</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="c1">-- Variable lifecycle</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="n">is_sensitive</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span><span class="w">  </span><span class="c1">-- Should this be encrypted/masked?</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="n">is_required_for_resume</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">build_id</span><span class="p">,</span><span class="w"> </span><span class="n">variable_key</span><span class="p">)</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="p">);</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_variables_build_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_variables</span><span class="p">(</span><span class="n">build_id</span><span class="p">);</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_variables_required</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_variables</span><span class="p">(</span><span class="n">is_required_for_resume</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">is_required_for_resume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="3-resumable_states-table">3. <code>resumable_states</code> Table<a class="headerlink" href="#3-resumable_states-table" title="Permanent link">&para;</a></h4>
<p>Defines which state codes are resumable and their requirements.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">resumable_states</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="n">project_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">projects</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="n">state_code</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="c1">-- Resumability configuration</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="n">is_resumable</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">TRUE</span><span class="p">,</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="n">resume_strategy</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w">  </span><span class="c1">-- &#39;from_artifact&#39;, &#39;rerun_state&#39;, &#39;skip_to_next&#39;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="c1">-- Requirements for resumption</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="n">required_artifacts</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w">     </span><span class="c1">-- Array of artifact names/types needed</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="n">required_variables</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w">     </span><span class="c1">-- Array of variable keys needed</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="c1">-- Resume script/command</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="n">resume_command</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">          </span><span class="c1">-- Command or script to execute on resume</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="n">resume_timeout_seconds</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">    </span><span class="c1">-- Documentation</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">    </span><span class="n">notes</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="n">state_code</span><span class="p">)</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="p">);</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_resumable_states_project</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">resumable_states</span><span class="p">(</span><span class="n">project_id</span><span class="p">);</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_resumable_states_resumable</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">resumable_states</span><span class="p">(</span><span class="n">is_resumable</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">is_resumable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">TRUE</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="4-resume_requests-table">4. <code>resume_requests</code> Table<a class="headerlink" href="#4-resume_requests-table" title="Permanent link">&para;</a></h4>
<p>Tracks requests to resume builds and their status.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">resume_requests</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">build_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">builds</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="c1">-- Resume details</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="n">resume_from_state</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="n">resume_to_state</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span><span class="w">              </span><span class="c1">-- NULL means resume to completion</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="n">resume_reason</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="c1">-- Request source</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="n">requested_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="w">            </span><span class="c1">-- User/system that requested resume</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="n">request_source</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w">           </span><span class="c1">-- &#39;api&#39;, &#39;webhook&#39;, &#39;cli&#39;, &#39;auto&#39;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="c1">-- Orchestration</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">    </span><span class="n">orchestration_job_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">            </span><span class="c1">-- Concourse/Jenkins job ID</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">    </span><span class="n">orchestration_job_url</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">    </span><span class="n">orchestration_status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w">     </span><span class="c1">-- &#39;pending&#39;, &#39;triggered&#39;, &#39;running&#39;, &#39;completed&#39;, &#39;failed&#39;</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="c1">-- Execution tracking</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">    </span><span class="n">triggered_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">    </span><span class="n">completed_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="n">error_message</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">    </span><span class="c1">-- Metadata</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="p">);</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_resume_requests_build_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">resume_requests</span><span class="p">(</span><span class="n">build_id</span><span class="p">);</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_resume_requests_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">resume_requests</span><span class="p">(</span><span class="n">orchestration_status</span><span class="p">);</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_resume_requests_created</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">resume_requests</span><span class="p">(</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="5-build_jobs-table">5. <code>build_jobs</code> Table<a class="headerlink" href="#5-build_jobs-table" title="Permanent link">&para;</a></h4>
<p>Links builds to CI/CD job information.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">build_jobs</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="n">build_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">builds</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="c1">-- CI/CD platform details</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="n">platform</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">        </span><span class="c1">-- &#39;concourse&#39;, &#39;jenkins&#39;, &#39;gitlab-ci&#39;, &#39;github-actions&#39;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="n">pipeline_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="n">job_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="n">job_url</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="c1">-- Job identification</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="n">job_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                          </span><span class="c1">-- Platform-specific job ID</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="n">build_number</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="c1">-- Trigger information</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="n">triggered_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="n">trigger_source</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w">           </span><span class="c1">-- &#39;manual&#39;, &#39;webhook&#39;, &#39;schedule&#39;, &#39;resume&#39;</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="c1">-- Job status</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span><span class="w">                   </span><span class="c1">-- &#39;pending&#39;, &#39;running&#39;, &#39;success&#39;, &#39;failed&#39;, &#39;aborted&#39;</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">    </span><span class="n">started_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="n">completed_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">    </span><span class="c1">-- Resume context</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">    </span><span class="n">is_resume_job</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">    </span><span class="n">resumed_from_state</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">    </span><span class="n">parent_job_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">build_jobs</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="p">);</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_jobs_build_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_jobs</span><span class="p">(</span><span class="n">build_id</span><span class="p">);</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_jobs_platform_job</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_jobs</span><span class="p">(</span><span class="n">platform</span><span class="p">,</span><span class="w"> </span><span class="n">job_id</span><span class="p">);</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_build_jobs_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">build_jobs</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="schema-relationships">Schema Relationships<a class="headerlink" href="#schema-relationships" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>erDiagram
    builds ||--o{ build_artifacts : has
    builds ||--o{ build_variables : has
    builds ||--o{ resume_requests : has
    builds ||--o{ build_jobs : has
    builds ||--o{ build_states : has
    projects ||--o{ resumable_states : defines
    resume_requests ||--o| build_jobs : triggers
    build_jobs ||--o| build_jobs : resumes

    builds {
        uuid id PK
        text project_id FK
        text platform_id FK
        text os_version_id FK
        text image_type_id FK
        int current_state
        string status
    }

    build_artifacts {
        uuid id PK
        uuid build_id FK
        int state_code
        string artifact_name
        string artifact_type
        text artifact_path
        string storage_backend
        boolean is_resumable
        boolean is_final
    }

    build_variables {
        uuid id PK
        uuid build_id FK
        string variable_key
        text variable_value
        int set_at_state
        boolean is_required_for_resume
    }

    resumable_states {
        uuid id PK
        text project_id FK
        int state_code
        boolean is_resumable
        string resume_strategy
        jsonb required_artifacts
        text resume_command
    }

    resume_requests {
        uuid id PK
        uuid build_id FK
        int resume_from_state
        string orchestration_status
        text orchestration_job_url
    }

    build_jobs {
        uuid id PK
        uuid build_id FK
        string platform
        string job_name
        boolean is_resume_job
        int resumed_from_state
        uuid parent_job_id FK
    }</code></pre>
<h2 id="build-workflow-with-resumability">üîÑ Build Workflow with Resumability<a class="headerlink" href="#build-workflow-with-resumability" title="Permanent link">&para;</a></h2>
<h3 id="normal-build-flow">Normal Build Flow<a class="headerlink" href="#normal-build-flow" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant CI as CI/CD Job
    participant CLI as bldst CLI
    participant API as Build State API
    participant DB as Database
    participant Storage as Cloud Storage

    Note over CI,Storage: Initial Build Start

    CI-&gt;&gt;CLI: bldst build create
    CLI-&gt;&gt;API: POST /builds
    API-&gt;&gt;DB: Create build record
    API--&gt;&gt;CLI: build_id
    CLI--&gt;&gt;CI: build_id

    Note over CI,Storage: State Progression

    loop Each Build Step
        CI-&gt;&gt;CLI: bldst build update-state --state X
        CLI-&gt;&gt;API: POST /builds/{id}/state
        API-&gt;&gt;DB: Update current_state

        alt Step produces artifact
            CI-&gt;&gt;Storage: Upload artifact
            CI-&gt;&gt;CLI: bldst artifact register
            CLI-&gt;&gt;API: POST /builds/{id}/artifacts
            API-&gt;&gt;DB: Store artifact metadata
        end

        alt Step needs variables
            CI-&gt;&gt;CLI: bldst variable set key=value
            CLI-&gt;&gt;API: POST /builds/{id}/variables
            API-&gt;&gt;DB: Store variable
        end
    end

    Note over CI,Storage: Build Complete
    CI-&gt;&gt;CLI: bldst build update-state --state 100
    CLI-&gt;&gt;API: POST /builds/{id}/state
    API-&gt;&gt;DB: Mark build complete</code></pre>
<h3 id="build-failure-and-resume-flow">Build Failure and Resume Flow<a class="headerlink" href="#build-failure-and-resume-flow" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant CI as CI/CD Job
    participant CLI as bldst CLI
    participant API as Build State API
    participant Orch as Orchestrator
    participant Webhook as Webhook Handler
    participant DB as Database

    Note over CI,Webhook: Build Fails at State 35

    CI-&gt;&gt;CLI: bldst build record-failure --state 35
    CLI-&gt;&gt;API: POST /builds/{id}/failure
    API-&gt;&gt;DB: Record failure
    API-&gt;&gt;Webhook: Trigger failure webhook

    Note over CI,Webhook: Decision to Resume

    Webhook-&gt;&gt;Orch: Build failed notification
    Orch-&gt;&gt;API: GET /builds/{id}
    API--&gt;&gt;Orch: Build details
    Orch-&gt;&gt;API: GET /builds/{id}/artifacts?resumable=true
    API--&gt;&gt;Orch: List of resumable artifacts

    alt Auto-resume enabled
        Orch-&gt;&gt;API: POST /builds/{id}/resume
        API-&gt;&gt;DB: Create resume_request
        Orch-&gt;&gt;CI: Trigger new job with resume params
    else Manual resume
        Note over Orch: Admin reviews failure
        Orch-&gt;&gt;API: POST /builds/{id}/resume
        API-&gt;&gt;DB: Create resume_request
        API--&gt;&gt;Orch: resume_request_id
        Orch-&gt;&gt;CI: Trigger new job with resume params
    end

    Note over CI,DB: Resume Job Starts

    CI-&gt;&gt;CLI: bldst build resume {build_id}
    CLI-&gt;&gt;API: GET /builds/{id}/resume-context
    API-&gt;&gt;DB: Get artifacts + variables + last state
    API--&gt;&gt;CLI: Resume context
    CLI--&gt;&gt;CI: Resume from state 35

    CI-&gt;&gt;CLI: Restore artifacts from state 30
    CLI-&gt;&gt;API: GET /builds/{id}/artifacts?state=30
    API--&gt;&gt;CLI: Artifact metadata
    CLI--&gt;&gt;CI: Download from storage_path

    Note over CI: Skip to failed state
    CI-&gt;&gt;CLI: bldst build update-state --state 35
    Note over CI: Continue from here</code></pre>
<h3 id="artifact-lifecycle">Artifact Lifecycle<a class="headerlink" href="#artifact-lifecycle" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; Created: Artifact produced
    Created --&gt; Registered: bldst artifact register
    Registered --&gt; Validated: Checksum verified
    Validated --&gt; Resumable: marked is_resumable=true
    Resumable --&gt; Used: Used in resume
    Used --&gt; Expired: TTL reached
    Expired --&gt; Deleted: Cleanup job
    Resumable --&gt; Final: marked is_final=true
    Final --&gt; Archived: Long-term storage
    Deleted --&gt; [*]
    Archived --&gt; [*]</code></pre>
<h2 id="api-endpoints">üîå API Endpoints<a class="headerlink" href="#api-endpoints" title="Permanent link">&para;</a></h2>
<h3 id="artifact-management">Artifact Management<a class="headerlink" href="#artifact-management" title="Permanent link">&para;</a></h3>
<h4 id="post-buildsbuild_idartifacts">POST <code>/builds/{build_id}/artifacts</code><a class="headerlink" href="#post-buildsbuild_idartifacts" title="Permanent link">&para;</a></h4>
<p>Register a new artifact for a build.</p>
<p><strong>Request:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;state_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nt">&quot;artifact_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rhel9-base-snapshot-001&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">&quot;artifact_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vm_snapshot&quot;</span><span class="p">,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nt">&quot;artifact_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/builds/abc123/snapshot-001.vmdk&quot;</span><span class="p">,</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="nt">&quot;storage_backend&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3&quot;</span><span class="p">,</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">  </span><span class="nt">&quot;storage_region&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">  </span><span class="nt">&quot;storage_bucket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-bucket&quot;</span><span class="p">,</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">  </span><span class="nt">&quot;storage_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;builds/abc123/snapshot-001.vmdk&quot;</span><span class="p">,</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">  </span><span class="nt">&quot;size_bytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5368709120</span><span class="p">,</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="nt">&quot;checksum&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4...&quot;</span><span class="p">,</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">  </span><span class="nt">&quot;is_resumable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">  </span><span class="nt">&quot;is_final&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">  </span><span class="nt">&quot;expires_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-21T00:00:00Z&quot;</span><span class="p">,</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="nt">&quot;vm_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;i-0123456789abcdef&quot;</span><span class="p">,</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="nt">&quot;snapshot_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snap-0123456789abcdef&quot;</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Response (201):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;art-uuid-123&quot;</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="nt">&quot;build_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build-uuid-456&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="nt">&quot;state_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="nt">&quot;artifact_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rhel9-base-snapshot-001&quot;</span><span class="p">,</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="nt">&quot;artifact_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vm_snapshot&quot;</span><span class="p">,</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">  </span><span class="nt">&quot;artifact_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://my-bucket/builds/abc123/snapshot-001.vmdk&quot;</span><span class="p">,</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">  </span><span class="nt">&quot;storage_backend&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3&quot;</span><span class="p">,</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">  </span><span class="nt">&quot;is_resumable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">  </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-14T12:00:00Z&quot;</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="get-buildsbuild_idartifacts">GET <code>/builds/{build_id}/artifacts</code><a class="headerlink" href="#get-buildsbuild_idartifacts" title="Permanent link">&para;</a></h4>
<p>List all artifacts for a build.</p>
<p><strong>Query Parameters:</strong>
- <code>state_code</code> (int) - Filter by state code
- <code>artifact_type</code> (string) - Filter by type
- <code>is_resumable</code> (bool) - Only resumable artifacts
- <code>is_final</code> (bool) - Only final artifacts</p>
<p><strong>Response:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">[</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;art-uuid-123&quot;</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="nt">&quot;artifact_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rhel9-base-snapshot-001&quot;</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="nt">&quot;state_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="nt">&quot;artifact_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vm_snapshot&quot;</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="nt">&quot;storage_backend&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3&quot;</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="nt">&quot;artifact_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://...&quot;</span><span class="p">,</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="nt">&quot;is_resumable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="p">]</span>
</span></code></pre></div></p>
<h4 id="get-buildsbuild_idartifactsartifact_id">GET <code>/builds/{build_id}/artifacts/{artifact_id}</code><a class="headerlink" href="#get-buildsbuild_idartifactsartifact_id" title="Permanent link">&para;</a></h4>
<p>Get specific artifact details.</p>
<h4 id="delete-buildsbuild_idartifactsartifact_id">DELETE <code>/builds/{build_id}/artifacts/{artifact_id}</code><a class="headerlink" href="#delete-buildsbuild_idartifactsartifact_id" title="Permanent link">&para;</a></h4>
<p>Soft delete an artifact (requires admin scope).</p>
<h3 id="variable-management">Variable Management<a class="headerlink" href="#variable-management" title="Permanent link">&para;</a></h3>
<h4 id="post-buildsbuild_idvariables">POST <code>/builds/{build_id}/variables</code><a class="headerlink" href="#post-buildsbuild_idvariables" title="Permanent link">&para;</a></h4>
<p>Set a build variable.</p>
<p><strong>Request:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;variable_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vm_instance_id&quot;</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="nt">&quot;variable_value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;i-0123456789abcdef&quot;</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="nt">&quot;variable_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="nt">&quot;set_at_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="nt">&quot;is_required_for_resume&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">  </span><span class="nt">&quot;is_sensitive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="get-buildsbuild_idvariables">GET <code>/builds/{build_id}/variables</code><a class="headerlink" href="#get-buildsbuild_idvariables" title="Permanent link">&para;</a></h4>
<p>Get all variables for a build.</p>
<p><strong>Query Parameters:</strong>
- <code>required_for_resume</code> (bool) - Only required variables</p>
<h4 id="patch-buildsbuild_idvariableskey">PATCH <code>/builds/{build_id}/variables/{key}</code><a class="headerlink" href="#patch-buildsbuild_idvariableskey" title="Permanent link">&para;</a></h4>
<p>Update a variable value.</p>
<h4 id="delete-buildsbuild_idvariableskey">DELETE <code>/builds/{build_id}/variables/{key}</code><a class="headerlink" href="#delete-buildsbuild_idvariableskey" title="Permanent link">&para;</a></h4>
<p>Delete a variable.</p>
<h3 id="resume-operations">Resume Operations<a class="headerlink" href="#resume-operations" title="Permanent link">&para;</a></h3>
<h4 id="post-buildsbuild_idresume">POST <code>/builds/{build_id}/resume</code><a class="headerlink" href="#post-buildsbuild_idresume" title="Permanent link">&para;</a></h4>
<p>Request to resume a build.</p>
<p><strong>Request:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nt">&quot;resume_from_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="nt">&quot;resume_to_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="nt">&quot;resume_reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Network timeout during package installation&quot;</span><span class="p">,</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="nt">&quot;requested_by&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ops-team&quot;</span><span class="p">,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="nt">&quot;orchestration_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="nt">&quot;platform&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;concourse&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="nt">&quot;pipeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rhel9-images&quot;</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="nt">&quot;job&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build-base-image&quot;</span><span class="p">,</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nt">&quot;trigger_webhook&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://concourse.example.com/api/v1/teams/main/pipelines/rhel9-images/jobs/build-base-image/builds&quot;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Response (201):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="nt">&quot;resume_request_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;resume-uuid-789&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nt">&quot;build_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build-uuid-456&quot;</span><span class="p">,</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">&quot;resume_from_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="nt">&quot;orchestration_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-14T13:00:00Z&quot;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="get-buildsbuild_idresume-context">GET <code>/builds/{build_id}/resume-context</code><a class="headerlink" href="#get-buildsbuild_idresume-context" title="Permanent link">&para;</a></h4>
<p>Get everything needed to resume a build.</p>
<p><strong>Response:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">&quot;build_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build-uuid-456&quot;</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="nt">&quot;current_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="nt">&quot;last_successful_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">  </span><span class="nt">&quot;failed_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span><span class="nt">&quot;resume_from_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">  </span><span class="nt">&quot;artifacts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">      </span><span class="nt">&quot;state_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">      </span><span class="nt">&quot;artifact_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;base-vm&quot;</span><span class="p">,</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">      </span><span class="nt">&quot;artifact_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://...&quot;</span><span class="p">,</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">      </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">      </span><span class="nt">&quot;state_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">      </span><span class="nt">&quot;artifact_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snapshot-001&quot;</span><span class="p">,</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">      </span><span class="nt">&quot;artifact_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3://...&quot;</span><span class="p">,</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">      </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">  </span><span class="nt">&quot;variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w">    </span><span class="nt">&quot;vm_instance_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;i-0123456789abcdef&quot;</span><span class="p">,</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w">    </span><span class="nt">&quot;vpc_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vpc-0123456789&quot;</span><span class="p">,</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="w">    </span><span class="nt">&quot;subnet_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subnet-0123456789&quot;</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="w">  </span><span class="nt">&quot;resumable_state_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="w">    </span><span class="nt">&quot;resume_strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;from_artifact&quot;</span><span class="p">,</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="w">    </span><span class="nt">&quot;required_artifacts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;snapshot-001&quot;</span><span class="p">],</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="w">    </span><span class="nt">&quot;required_variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;vm_instance_id&quot;</span><span class="p">],</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="w">    </span><span class="nt">&quot;resume_command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./scripts/resume-from-snapshot.sh&quot;</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="get-buildsbuild_idresume-requests">GET <code>/builds/{build_id}/resume-requests</code><a class="headerlink" href="#get-buildsbuild_idresume-requests" title="Permanent link">&para;</a></h4>
<p>List all resume requests for a build.</p>
<h4 id="get-resume-requestsrequest_id">GET <code>/resume-requests/{request_id}</code><a class="headerlink" href="#get-resume-requestsrequest_id" title="Permanent link">&para;</a></h4>
<p>Get details of a specific resume request.</p>
<h4 id="patch-resume-requestsrequest_id">PATCH <code>/resume-requests/{request_id}</code><a class="headerlink" href="#patch-resume-requestsrequest_id" title="Permanent link">&para;</a></h4>
<p>Update resume request status (for orchestrator).</p>
<p><strong>Request:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="nt">&quot;orchestration_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;triggered&quot;</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="nt">&quot;orchestration_job_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123456&quot;</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="nt">&quot;orchestration_job_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://ci.example.com/job/123456&quot;</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="nt">&quot;triggered_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-14T13:05:00Z&quot;</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">}</span>
</span></code></pre></div></p>
<h3 id="resumable-state-configuration">Resumable State Configuration<a class="headerlink" href="#resumable-state-configuration" title="Permanent link">&para;</a></h3>
<h4 id="post-projectsproject_idresumable-states">POST <code>/projects/{project_id}/resumable-states</code><a class="headerlink" href="#post-projectsproject_idresumable-states" title="Permanent link">&para;</a></h4>
<p>Define which states are resumable.</p>
<p><strong>Request:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="nt">&quot;state_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="nt">&quot;is_resumable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="nt">&quot;resume_strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;from_artifact&quot;</span><span class="p">,</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">  </span><span class="nt">&quot;required_artifacts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;vm_snapshot&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;network_config&quot;</span><span class="p">],</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">  </span><span class="nt">&quot;required_variables&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;vm_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;vpc_id&quot;</span><span class="p">],</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">  </span><span class="nt">&quot;resume_command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./scripts/resume-package-install.sh&quot;</span><span class="p">,</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">  </span><span class="nt">&quot;resume_timeout_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3600</span><span class="p">,</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Resume package installation from snapshot&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="get-projectsproject_idresumable-states">GET <code>/projects/{project_id}/resumable-states</code><a class="headerlink" href="#get-projectsproject_idresumable-states" title="Permanent link">&para;</a></h4>
<p>List resumable state configurations.</p>
<h4 id="get-projectsproject_idresumable-statesstate_code">GET <code>/projects/{project_id}/resumable-states/{state_code}</code><a class="headerlink" href="#get-projectsproject_idresumable-statesstate_code" title="Permanent link">&para;</a></h4>
<p>Get specific resumable state config.</p>
<h4 id="put-projectsproject_idresumable-statesstate_code">PUT <code>/projects/{project_id}/resumable-states/{state_code}</code><a class="headerlink" href="#put-projectsproject_idresumable-statesstate_code" title="Permanent link">&para;</a></h4>
<p>Update resumable state configuration.</p>
<h2 id="cli-commands">üéÆ CLI Commands<a class="headerlink" href="#cli-commands" title="Permanent link">&para;</a></h2>
<h3 id="artifact-commands">Artifact Commands<a class="headerlink" href="#artifact-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Register an artifact</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>bldst<span class="w"> </span>artifact<span class="w"> </span>register<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span>--state<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;rhel9-snapshot-001&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span>--type<span class="w"> </span><span class="s2">&quot;vm_snapshot&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">  </span>--path<span class="w"> </span><span class="s2">&quot;s3://bucket/path/to/snapshot.vmdk&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">  </span>--backend<span class="w"> </span>s3<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">  </span>--resumable<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">  </span>--metadata<span class="w"> </span><span class="s1">&#39;{&quot;vm_id&quot;: &quot;i-abc123&quot;, &quot;snapshot_id&quot;: &quot;snap-xyz789&quot;}&#39;</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="c1"># List artifacts for a build</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>bldst<span class="w"> </span>artifact<span class="w"> </span>list<span class="w"> </span>&lt;build-id&gt;
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="c1"># List only resumable artifacts</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>bldst<span class="w"> </span>artifact<span class="w"> </span>list<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>--resumable
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="c1"># Get artifact details</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>bldst<span class="w"> </span>artifact<span class="w"> </span>get<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>&lt;artifact-id&gt;
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="c1"># Delete artifact</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>bldst<span class="w"> </span>artifact<span class="w"> </span>delete<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>&lt;artifact-id&gt;
</span></code></pre></div>
<h3 id="variable-commands">Variable Commands<a class="headerlink" href="#variable-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Set a variable</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>bldst<span class="w"> </span>variable<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;build-id&gt;<span class="w"> </span><span class="nv">vm_id</span><span class="o">=</span>i-abc123<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span>--state<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span>--required-for-resume
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="c1"># Set multiple variables</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>bldst<span class="w"> </span>variable<span class="w"> </span><span class="nb">set</span><span class="w"> </span>&lt;build-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">  </span><span class="nv">vm_id</span><span class="o">=</span>i-abc123<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">  </span><span class="nv">vpc_id</span><span class="o">=</span>vpc-xyz789<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">  </span><span class="nv">subnet_id</span><span class="o">=</span>subnet-123<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span>--state<span class="w"> </span><span class="m">20</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="c1"># Get all variables</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>bldst<span class="w"> </span>variable<span class="w"> </span>list<span class="w"> </span>&lt;build-id&gt;
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="c1"># Get variable value</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>bldst<span class="w"> </span>variable<span class="w"> </span>get<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>vm_id
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="c1"># Delete variable</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>bldst<span class="w"> </span>variable<span class="w"> </span>delete<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>vm_id
</span></code></pre></div>
<h3 id="resume-commands">Resume Commands<a class="headerlink" href="#resume-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Get resume context (what&#39;s needed to resume)</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>bldst<span class="w"> </span>build<span class="w"> </span>resume-context<span class="w"> </span>&lt;build-id&gt;
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># Output in different formats</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>bldst<span class="w"> </span>build<span class="w"> </span>resume-context<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>--output<span class="w"> </span>json
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>bldst<span class="w"> </span>build<span class="w"> </span>resume-context<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>--output<span class="w"> </span>yaml
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>bldst<span class="w"> </span>build<span class="w"> </span>resume-context<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span>--output<span class="w"> </span>env<span class="w">  </span><span class="c1"># For sourcing in shell</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="c1"># Request a resume</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>bldst<span class="w"> </span>build<span class="w"> </span>resume<span class="w"> </span>&lt;build-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span>--from-state<span class="w"> </span><span class="m">35</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">  </span>--reason<span class="w"> </span><span class="s2">&quot;Network timeout during package installation&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">  </span>--platform<span class="w"> </span>concourse<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">  </span>--pipeline<span class="w"> </span>rhel9-images<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">  </span>--job<span class="w"> </span>build-base-image
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="c1"># List resume requests</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>bldst<span class="w"> </span>build<span class="w"> </span>resume-requests<span class="w"> </span>&lt;build-id&gt;
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="c1"># Check resume request status</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>bldst<span class="w"> </span>resume-request<span class="w"> </span>get<span class="w"> </span>&lt;request-id&gt;
</span></code></pre></div>
<h3 id="resumable-state-configuration_1">Resumable State Configuration<a class="headerlink" href="#resumable-state-configuration_1" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Define a resumable state for a project</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>bldst<span class="w"> </span>resumable-state<span class="w"> </span>create<span class="w"> </span>&lt;project-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span>--state<span class="w"> </span><span class="m">35</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span>--strategy<span class="w"> </span>from_artifact<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span>--required-artifacts<span class="w"> </span><span class="s2">&quot;vm_snapshot,network_config&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span>--required-variables<span class="w"> </span><span class="s2">&quot;vm_id,vpc_id&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">  </span>--command<span class="w"> </span><span class="s2">&quot;./scripts/resume-package-install.sh&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">  </span>--timeout<span class="w"> </span><span class="m">3600</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="c1"># List resumable states for project</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>bldst<span class="w"> </span>resumable-state<span class="w"> </span>list<span class="w"> </span>&lt;project-id&gt;
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="c1"># Get resumable state config</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>bldst<span class="w"> </span>resumable-state<span class="w"> </span>get<span class="w"> </span>&lt;project-id&gt;<span class="w"> </span><span class="m">35</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="c1"># Update resumable state</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>bldst<span class="w"> </span>resumable-state<span class="w"> </span>update<span class="w"> </span>&lt;project-id&gt;<span class="w"> </span><span class="m">35</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">  </span>--timeout<span class="w"> </span><span class="m">7200</span>
</span></code></pre></div>
<h2 id="orchestrator-service">ü§ñ Orchestrator Service<a class="headerlink" href="#orchestrator-service" title="Permanent link">&para;</a></h2>
<h3 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>graph TB
    subgraph "Orchestrator Service"
        A[Webhook Listener]
        B[Resume Queue]
        C[Job Trigger]
        D[Status Monitor]
    end

    subgraph "External Systems"
        E[Build State API]
        F[Concourse]
        G[Jenkins]
        H[GitLab CI]
        I[SNS/SQS]
    end

    E --&gt;|failure webhook| A
    I --&gt;|message| A
    A --&gt; B
    B --&gt; C
    C --&gt;|trigger job| F
    C --&gt;|trigger job| G
    C --&gt;|trigger job| H
    F --&gt;|job status| D
    G --&gt;|job status| D
    H --&gt;|job status| D
    D --&gt;|update status| E

    style A fill:#f96,stroke:#333
    style C fill:#9cf,stroke:#333
    style B fill:#fc9,stroke:#333</code></pre>
<h3 id="orchestrator-components">Orchestrator Components<a class="headerlink" href="#orchestrator-components" title="Permanent link">&para;</a></h3>
<h4 id="1-webhook-handler">1. Webhook Handler<a class="headerlink" href="#1-webhook-handler" title="Permanent link">&para;</a></h4>
<p>Receives failure notifications and queues resume requests.</p>
<p><strong>Endpoints:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>POST /webhooks/build-failure
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>POST /webhooks/sns
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>POST /webhooks/sqs
</span></code></pre></div></p>
<p><strong>Build Failure Webhook Payload:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build.failed&quot;</span><span class="p">,</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="nt">&quot;build_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build-uuid-456&quot;</span><span class="p">,</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">  </span><span class="nt">&quot;current_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="nt">&quot;last_successful_state&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">  </span><span class="nt">&quot;failure_reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Network timeout&quot;</span><span class="p">,</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-02-14T12:30:00Z&quot;</span><span class="p">,</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="nt">&quot;ci_platform&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;concourse&quot;</span><span class="p">,</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="nt">&quot;pipeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rhel9-images&quot;</span><span class="p">,</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="nt">&quot;job&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build-base-image&quot;</span><span class="p">,</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="nt">&quot;build_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;123&quot;</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="p">}</span>
</span></code></pre></div></p>
<h4 id="2-resume-queue">2. Resume Queue<a class="headerlink" href="#2-resume-queue" title="Permanent link">&para;</a></h4>
<p>Manages pending resume requests with priority and retry logic.</p>
<p><strong>Features:</strong>
- Priority queue (critical builds first)
- Retry with exponential backoff
- Rate limiting per CI platform
- Dead letter queue for failed resumes</p>
<h4 id="3-job-trigger">3. Job Trigger<a class="headerlink" href="#3-job-trigger" title="Permanent link">&para;</a></h4>
<p>Triggers CI/CD jobs with resume parameters.</p>
<p><strong>Concourse Example:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Trigger Concourse job with resume params</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>fly<span class="w"> </span>-t<span class="w"> </span>main<span class="w"> </span>trigger-job<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span>--job<span class="w"> </span>rhel9-images/build-base-image<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span>--var<span class="w"> </span><span class="nv">build_id</span><span class="o">=</span>build-uuid-456<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span>--var<span class="w"> </span><span class="nv">resume_mode</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">  </span>--var<span class="w"> </span><span class="nv">resume_from_state</span><span class="o">=</span><span class="m">35</span>
</span></code></pre></div></p>
<p><strong>Jenkins Example:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Trigger Jenkins job with resume params</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">  </span><span class="s2">&quot;https://jenkins.example.com/job/rhel9-images/job/build-base-image/buildWithParameters&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">  </span>--user<span class="w"> </span>token:API_TOKEN<span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">  </span>--data<span class="w"> </span><span class="s2">&quot;BUILD_ID=build-uuid-456&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">  </span>--data<span class="w"> </span><span class="s2">&quot;RESUME_MODE=true&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">  </span>--data<span class="w"> </span><span class="s2">&quot;RESUME_FROM_STATE=35&quot;</span>
</span></code></pre></div></p>
<h4 id="4-status-monitor">4. Status Monitor<a class="headerlink" href="#4-status-monitor" title="Permanent link">&para;</a></h4>
<p>Monitors triggered jobs and updates resume request status.</p>
<p><strong>Polling Strategy:</strong>
- Poll every 30 seconds for running jobs
- Update API with job status
- Detect stalled jobs (no progress for 10 minutes)
- Send alerts on repeated failures</p>
<h3 id="orchestrator-configuration">Orchestrator Configuration<a class="headerlink" href="#orchestrator-configuration" title="Permanent link">&para;</a></h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nt">orchestrator</span><span class="p">:</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span><span class="nt">workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="nt">queue</span><span class="p">:</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="nt">backend</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="nt">max_queue_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">    </span><span class="nt">retry_attempts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="nt">retry_backoff_seconds</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">60</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">300</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">900</span><span class="p p-Indicator">]</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span><span class="nt">webhooks</span><span class="p">:</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8090</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${WEBHOOK_SECRET}&quot;</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">  </span><span class="nt">platforms</span><span class="p">:</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">concourse</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">      </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://concourse.example.com&quot;</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">      </span><span class="nt">team</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${CONCOURSE_USER}&quot;</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${CONCOURSE_PASS}&quot;</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">      </span><span class="nt">rate_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">  </span><span class="c1"># jobs per minute</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jenkins</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">      </span><span class="nt">base_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://jenkins.example.com&quot;</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${JENKINS_USER}&quot;</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">      </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${JENKINS_TOKEN}&quot;</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">      </span><span class="nt">rate_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">    </span><span class="nt">poll_interval_seconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">    </span><span class="nt">stall_timeout_seconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="w">  </span><span class="nt">notifications</span><span class="p">:</span>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="w">    </span><span class="nt">slack_webhook</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${SLACK_WEBHOOK}&quot;</span>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="w">    </span><span class="nt">email_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span></code></pre></div>
<h2 id="build-script-integration">üìù Build Script Integration<a class="headerlink" href="#build-script-integration" title="Permanent link">&para;</a></h2>
<h3 id="initial-build-with-artifact-tracking">Initial Build (with artifact tracking)<a class="headerlink" href="#initial-build-with-artifact-tracking" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="c1"># Configuration</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="nv">BUILD_ID</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BUILD_ID</span><span class="k">:-$(</span>uuidgen<span class="k">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="nv">PROJECT_ID</span><span class="o">=</span><span class="s2">&quot;rhel9-base&quot;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="nv">STATE_CODE</span><span class="o">=</span><span class="m">0</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="c1"># Initialize build</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating build record...&quot;</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="nv">BUILD_ID</span><span class="o">=</span><span class="k">$(</span>bldst<span class="w"> </span>build<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">  </span>--project-id<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PROJECT_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">  </span>--platform-id<span class="w"> </span>aws-commercial<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">  </span>--os-version-id<span class="w"> </span>rhel-9.3<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">  </span>--image-type-id<span class="w"> </span>base<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">  </span>--build-number<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CI_BUILD_NUMBER</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">  </span>--output<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Build ID: </span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="c1"># Save build ID for subsequent steps</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/build_id.txt
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="c1"># State 5: Validate configuration</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="nv">STATE_CODE</span><span class="o">=</span><span class="m">5</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;State </span><span class="nv">$STATE_CODE</span><span class="s2">: Validating configuration...&quot;</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>bldst<span class="w"> </span>build<span class="w"> </span>update-state<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="w">  </span>--state<span class="w"> </span><span class="nv">$STATE_CODE</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="w">  </span>--status<span class="w"> </span>in_progress<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="w">  </span>--message<span class="w"> </span><span class="s2">&quot;Validating Packer configuration&quot;</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>packer<span class="w"> </span>validate<span class="w"> </span>rhel9-base.pkr.hcl
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>bldst<span class="w"> </span>build<span class="w"> </span>update-state<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a><span class="w">  </span>--state<span class="w"> </span><span class="nv">$STATE_CODE</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a><span class="w">  </span>--status<span class="w"> </span>completed<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a><span class="w">  </span>--message<span class="w"> </span><span class="s2">&quot;Configuration validated&quot;</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a><span class="c1"># State 10: Create base VM</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a><span class="nv">STATE_CODE</span><span class="o">=</span><span class="m">10</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;State </span><span class="nv">$STATE_CODE</span><span class="s2">: Creating base VM...&quot;</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>bldst<span class="w"> </span>build<span class="w"> </span>update-state<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span>--state<span class="w"> </span><span class="nv">$STATE_CODE</span><span class="w"> </span>--status<span class="w"> </span>in_progress
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a><span class="c1"># Start packer build</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>packer<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a><span class="w">  </span>-var<span class="o">=</span><span class="s2">&quot;build_id=</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a><span class="w">  </span>-var<span class="o">=</span><span class="s2">&quot;build_state=10&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#__codelineno-24-48"></a><span class="w">  </span>rhel9-base.pkr.hcl<span class="w"> </span>&gt;<span class="w"> </span>/tmp/packer_output.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#__codelineno-24-49"></a>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#__codelineno-24-50"></a><span class="c1"># Extract VM ID from packer output</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#__codelineno-24-51"></a><span class="nv">VM_ID</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span><span class="s2">&quot;Created instance&quot;</span><span class="w"> </span>/tmp/packer_output.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $NF}&#39;</span><span class="k">)</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#__codelineno-24-52"></a>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#__codelineno-24-53"></a><span class="c1"># Store VM ID as variable</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#__codelineno-24-54"></a>bldst<span class="w"> </span>variable<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">vm_id</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$VM_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#__codelineno-24-55"></a><span class="w">  </span>--state<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56" href="#__codelineno-24-56"></a><span class="w">  </span>--required-for-resume
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57" href="#__codelineno-24-57"></a>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58" href="#__codelineno-24-58"></a>bldst<span class="w"> </span>build<span class="w"> </span>update-state<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span>--state<span class="w"> </span><span class="nv">$STATE_CODE</span><span class="w"> </span>--status<span class="w"> </span>completed
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59" href="#__codelineno-24-59"></a>
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60" href="#__codelineno-24-60"></a><span class="c1"># State 20: Install packages (long-running, resumable)</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61" href="#__codelineno-24-61"></a><span class="nv">STATE_CODE</span><span class="o">=</span><span class="m">20</span>
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62" href="#__codelineno-24-62"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;State </span><span class="nv">$STATE_CODE</span><span class="s2">: Installing packages...&quot;</span>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63" href="#__codelineno-24-63"></a>bldst<span class="w"> </span>build<span class="w"> </span>update-state<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span>--state<span class="w"> </span><span class="nv">$STATE_CODE</span><span class="w"> </span>--status<span class="w"> </span>in_progress
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64" href="#__codelineno-24-64"></a>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65" href="#__codelineno-24-65"></a><span class="c1"># This might fail due to network issues</span>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66" href="#__codelineno-24-66"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$VM_ID</span><span class="s2">,&quot;</span><span class="w"> </span>install-packages.yml<span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-24-67"><a id="__codelineno-24-67" name="__codelineno-24-67" href="#__codelineno-24-67"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Package installation failed!&quot;</span>
</span><span id="__span-24-68"><a id="__codelineno-24-68" name="__codelineno-24-68" href="#__codelineno-24-68"></a>
</span><span id="__span-24-69"><a id="__codelineno-24-69" name="__codelineno-24-69" href="#__codelineno-24-69"></a><span class="w">  </span><span class="c1"># Record failure</span>
</span><span id="__span-24-70"><a id="__codelineno-24-70" name="__codelineno-24-70" href="#__codelineno-24-70"></a><span class="w">  </span>bldst<span class="w"> </span>build<span class="w"> </span>record-failure<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-71"><a id="__codelineno-24-71" name="__codelineno-24-71" href="#__codelineno-24-71"></a><span class="w">    </span>--state<span class="w"> </span><span class="nv">$STATE_CODE</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-72"><a id="__codelineno-24-72" name="__codelineno-24-72" href="#__codelineno-24-72"></a><span class="w">    </span>--error<span class="w"> </span><span class="s2">&quot;Package installation failed&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-73"><a id="__codelineno-24-73" name="__codelineno-24-73" href="#__codelineno-24-73"></a><span class="w">    </span>--retryable
</span><span id="__span-24-74"><a id="__codelineno-24-74" name="__codelineno-24-74" href="#__codelineno-24-74"></a>
</span><span id="__span-24-75"><a id="__codelineno-24-75" name="__codelineno-24-75" href="#__codelineno-24-75"></a><span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-24-76"><a id="__codelineno-24-76" name="__codelineno-24-76" href="#__codelineno-24-76"></a><span class="k">fi</span>
</span><span id="__span-24-77"><a id="__codelineno-24-77" name="__codelineno-24-77" href="#__codelineno-24-77"></a>
</span><span id="__span-24-78"><a id="__codelineno-24-78" name="__codelineno-24-78" href="#__codelineno-24-78"></a><span class="c1"># Create snapshot after successful package installation</span>
</span><span id="__span-24-79"><a id="__codelineno-24-79" name="__codelineno-24-79" href="#__codelineno-24-79"></a><span class="nv">SNAPSHOT_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>ec2<span class="w"> </span>create-snapshot<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-80"><a id="__codelineno-24-80" name="__codelineno-24-80" href="#__codelineno-24-80"></a><span class="w">  </span>--volume-id<span class="w"> </span>vol-xyz<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-81"><a id="__codelineno-24-81" name="__codelineno-24-81" href="#__codelineno-24-81"></a><span class="w">  </span>--description<span class="w"> </span><span class="s2">&quot;Build </span><span class="nv">$BUILD_ID</span><span class="s2"> state 20&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-82"><a id="__codelineno-24-82" name="__codelineno-24-82" href="#__codelineno-24-82"></a><span class="w">  </span>--query<span class="w"> </span><span class="s1">&#39;SnapshotId&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-83"><a id="__codelineno-24-83" name="__codelineno-24-83" href="#__codelineno-24-83"></a><span class="w">  </span>--output<span class="w"> </span>text<span class="k">)</span>
</span><span id="__span-24-84"><a id="__codelineno-24-84" name="__codelineno-24-84" href="#__codelineno-24-84"></a>
</span><span id="__span-24-85"><a id="__codelineno-24-85" name="__codelineno-24-85" href="#__codelineno-24-85"></a><span class="c1"># Register artifact</span>
</span><span id="__span-24-86"><a id="__codelineno-24-86" name="__codelineno-24-86" href="#__codelineno-24-86"></a>bldst<span class="w"> </span>artifact<span class="w"> </span>register<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-87"><a id="__codelineno-24-87" name="__codelineno-24-87" href="#__codelineno-24-87"></a><span class="w">  </span>--state<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-88"><a id="__codelineno-24-88" name="__codelineno-24-88" href="#__codelineno-24-88"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;packages-installed-snapshot&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-89"><a id="__codelineno-24-89" name="__codelineno-24-89" href="#__codelineno-24-89"></a><span class="w">  </span>--type<span class="w"> </span><span class="s2">&quot;ebs_snapshot&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-90"><a id="__codelineno-24-90" name="__codelineno-24-90" href="#__codelineno-24-90"></a><span class="w">  </span>--path<span class="w"> </span><span class="s2">&quot;aws://snapshot/</span><span class="nv">$SNAPSHOT_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-91"><a id="__codelineno-24-91" name="__codelineno-24-91" href="#__codelineno-24-91"></a><span class="w">  </span>--backend<span class="w"> </span>aws<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-92"><a id="__codelineno-24-92" name="__codelineno-24-92" href="#__codelineno-24-92"></a><span class="w">  </span>--resumable<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-93"><a id="__codelineno-24-93" name="__codelineno-24-93" href="#__codelineno-24-93"></a><span class="w">  </span>--metadata<span class="w"> </span><span class="s2">&quot;{\&quot;snapshot_id\&quot;: \&quot;</span><span class="nv">$SNAPSHOT_ID</span><span class="s2">\&quot;, \&quot;vm_id\&quot;: \&quot;</span><span class="nv">$VM_ID</span><span class="s2">\&quot;}&quot;</span>
</span><span id="__span-24-94"><a id="__codelineno-24-94" name="__codelineno-24-94" href="#__codelineno-24-94"></a>
</span><span id="__span-24-95"><a id="__codelineno-24-95" name="__codelineno-24-95" href="#__codelineno-24-95"></a>bldst<span class="w"> </span>build<span class="w"> </span>update-state<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span>--state<span class="w"> </span><span class="nv">$STATE_CODE</span><span class="w"> </span>--status<span class="w"> </span>completed
</span><span id="__span-24-96"><a id="__codelineno-24-96" name="__codelineno-24-96" href="#__codelineno-24-96"></a>
</span><span id="__span-24-97"><a id="__codelineno-24-97" name="__codelineno-24-97" href="#__codelineno-24-97"></a><span class="c1"># Continue with remaining states...</span>
</span></code></pre></div>
<h3 id="resume-build-script">Resume Build Script<a class="headerlink" href="#resume-build-script" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1"># This script is triggered by the orchestrator with resume parameters</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nv">BUILD_ID</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BUILD_ID</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nv">RESUME_MODE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RESUME_MODE</span><span class="k">:-</span><span class="nv">false</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="nv">RESUME_FROM_STATE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RESUME_FROM_STATE</span><span class="k">:-</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Build ID: </span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Resume Mode: </span><span class="nv">$RESUME_MODE</span><span class="s2">&quot;</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Resume From State: </span><span class="nv">$RESUME_FROM_STATE</span><span class="s2">&quot;</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESUME_MODE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;===== RESUMING BUILD =====&quot;</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">  </span><span class="c1"># Get resume context</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">  </span><span class="nv">RESUME_CONTEXT</span><span class="o">=</span><span class="k">$(</span>bldst<span class="w"> </span>build<span class="w"> </span>resume-context<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_ID</span><span class="s2">&quot;</span><span class="w"> </span>--output<span class="w"> </span>json<span class="k">)</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">  </span><span class="c1"># Extract last successful state</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">  </span><span class="nv">LAST_STATE</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESUME_CONTEXT</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.last_successful_state&#39;</span><span class="k">)</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Last successful state: </span><span class="nv">$LAST_STATE</span><span class="s2">&quot;</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">  </span><span class="c1"># Get variables</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">  </span><span class="nv">VM_ID</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESUME_CONTEXT</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.variables.vm_id&#39;</span><span class="k">)</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="w">  </span><span class="nv">SNAPSHOT_ID</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESUME_CONTEXT</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.variables.snapshot_id // empty&#39;</span><span class="k">)</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restored variables:&quot;</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  VM_ID: </span><span class="nv">$VM_ID</span><span class="s2">&quot;</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  SNAPSHOT_ID: </span><span class="nv">$SNAPSHOT_ID</span><span class="s2">&quot;</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w">  </span><span class="c1"># Get last snapshot artifact</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESUME_FROM_STATE</span><span class="s2">&quot;</span><span class="w"> </span>-ge<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="w">    </span><span class="nv">SNAPSHOT_ARTIFACT</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$RESUME_CONTEXT</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="w">      </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.artifacts[] | select(.state_code == 20 and .artifact_type == &quot;ebs_snapshot&quot;) | .metadata.snapshot_id&#39;</span><span class="k">)</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SNAPSHOT_ARTIFACT</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a><span class="w">      </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restoring from snapshot: </span><span class="nv">$SNAPSHOT_ARTIFACT</span><span class="s2">&quot;</span>
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a>
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="w">      </span><span class="c1"># Create volume from snapshot</span>
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a><span class="w">      </span><span class="nv">VOLUME_ID</span><span class="o">=</span><span class="k">$(</span>aws<span class="w"> </span>ec2<span class="w"> </span>create-volume<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="w">        </span>--snapshot-id<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SNAPSHOT_ARTIFACT</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="w">        </span>--availability-zone<span class="w"> </span>us-east-1a<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="w">        </span>--query<span class="w"> </span><span class="s1">&#39;VolumeId&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a><span class="w">        </span>--output<span class="w"> </span>text<span class="k">)</span>
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a>
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="w">      </span><span class="c1"># Attach to instance</span>
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a><span class="w">      </span>aws<span class="w"> </span>ec2<span class="w"> </span>attach-volume<span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a><span class="w">        </span>--volume-id<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$VOLUME_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a><span class="w">        </span>--instance-id<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$VM_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a><span class="w">        </span>--device<span class="w"> </span>/dev/sdf
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a>
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a><span class="w">      </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Volume attached. Waiting for it to be available...&quot;</span>
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="w">      </span>aws<span class="w"> </span>ec2<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>volume-in-use<span class="w"> </span>--volume-ids<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$VOLUME_ID</span><span class="s2">&quot;</span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a><span class="w">  </span><span class="k">fi</span>
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a><span class="w">  </span><span class="c1"># Skip to the failed state</span>
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a><span class="w">  </span><span class="nv">START_STATE</span><span class="o">=</span><span class="nv">$RESUME_FROM_STATE</span>
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a><span class="k">else</span>
</span><span id="__span-25-60"><a id="__codelineno-25-60" name="__codelineno-25-60" href="#__codelineno-25-60"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;===== STARTING NEW BUILD =====&quot;</span>
</span><span id="__span-25-61"><a id="__codelineno-25-61" name="__codelineno-25-61" href="#__codelineno-25-61"></a><span class="w">  </span><span class="nv">START_STATE</span><span class="o">=</span><span class="m">0</span>
</span><span id="__span-25-62"><a id="__codelineno-25-62" name="__codelineno-25-62" href="#__codelineno-25-62"></a><span class="k">fi</span>
</span><span id="__span-25-63"><a id="__codelineno-25-63" name="__codelineno-25-63" href="#__codelineno-25-63"></a>
</span><span id="__span-25-64"><a id="__codelineno-25-64" name="__codelineno-25-64" href="#__codelineno-25-64"></a><span class="c1"># Execute states from START_STATE onwards</span>
</span><span id="__span-25-65"><a id="__codelineno-25-65" name="__codelineno-25-65" href="#__codelineno-25-65"></a><span class="k">case</span><span class="w"> </span><span class="nv">$START_STATE</span><span class="w"> </span><span class="k">in</span>
</span><span id="__span-25-66"><a id="__codelineno-25-66" name="__codelineno-25-66" href="#__codelineno-25-66"></a><span class="w">  </span><span class="m">0</span><span class="p">|</span><span class="m">5</span><span class="p">|</span><span class="m">10</span><span class="o">)</span>
</span><span id="__span-25-67"><a id="__codelineno-25-67" name="__codelineno-25-67" href="#__codelineno-25-67"></a><span class="w">    </span><span class="c1"># Run states 0-10 if not resuming</span>
</span><span id="__span-25-68"><a id="__codelineno-25-68" name="__codelineno-25-68" href="#__codelineno-25-68"></a><span class="w">    </span>run_state_10
</span><span id="__span-25-69"><a id="__codelineno-25-69" name="__codelineno-25-69" href="#__codelineno-25-69"></a><span class="w">    </span>run_state_20
</span><span id="__span-25-70"><a id="__codelineno-25-70" name="__codelineno-25-70" href="#__codelineno-25-70"></a><span class="w">    </span>run_state_30
</span><span id="__span-25-71"><a id="__codelineno-25-71" name="__codelineno-25-71" href="#__codelineno-25-71"></a><span class="w">    </span><span class="c1"># ... etc</span>
</span><span id="__span-25-72"><a id="__codelineno-25-72" name="__codelineno-25-72" href="#__codelineno-25-72"></a><span class="w">    </span><span class="p">;;</span>
</span><span id="__span-25-73"><a id="__codelineno-25-73" name="__codelineno-25-73" href="#__codelineno-25-73"></a><span class="w">  </span><span class="m">20</span><span class="o">)</span>
</span><span id="__span-25-74"><a id="__codelineno-25-74" name="__codelineno-25-74" href="#__codelineno-25-74"></a><span class="w">    </span><span class="c1"># Resume from state 20</span>
</span><span id="__span-25-75"><a id="__codelineno-25-75" name="__codelineno-25-75" href="#__codelineno-25-75"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Resuming from package installation...&quot;</span>
</span><span id="__span-25-76"><a id="__codelineno-25-76" name="__codelineno-25-76" href="#__codelineno-25-76"></a><span class="w">    </span>run_state_20
</span><span id="__span-25-77"><a id="__codelineno-25-77" name="__codelineno-25-77" href="#__codelineno-25-77"></a><span class="w">    </span>run_state_30
</span><span id="__span-25-78"><a id="__codelineno-25-78" name="__codelineno-25-78" href="#__codelineno-25-78"></a><span class="w">    </span><span class="c1"># ... etc</span>
</span><span id="__span-25-79"><a id="__codelineno-25-79" name="__codelineno-25-79" href="#__codelineno-25-79"></a><span class="w">    </span><span class="p">;;</span>
</span><span id="__span-25-80"><a id="__codelineno-25-80" name="__codelineno-25-80" href="#__codelineno-25-80"></a><span class="w">  </span><span class="m">30</span><span class="o">)</span>
</span><span id="__span-25-81"><a id="__codelineno-25-81" name="__codelineno-25-81" href="#__codelineno-25-81"></a><span class="w">    </span><span class="c1"># Resume from state 30</span>
</span><span id="__span-25-82"><a id="__codelineno-25-82" name="__codelineno-25-82" href="#__codelineno-25-82"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Resuming from configuration...&quot;</span>
</span><span id="__span-25-83"><a id="__codelineno-25-83" name="__codelineno-25-83" href="#__codelineno-25-83"></a><span class="w">    </span>run_state_30
</span><span id="__span-25-84"><a id="__codelineno-25-84" name="__codelineno-25-84" href="#__codelineno-25-84"></a><span class="w">    </span>run_state_40
</span><span id="__span-25-85"><a id="__codelineno-25-85" name="__codelineno-25-85" href="#__codelineno-25-85"></a><span class="w">    </span><span class="c1"># ... etc</span>
</span><span id="__span-25-86"><a id="__codelineno-25-86" name="__codelineno-25-86" href="#__codelineno-25-86"></a><span class="w">    </span><span class="p">;;</span>
</span><span id="__span-25-87"><a id="__codelineno-25-87" name="__codelineno-25-87" href="#__codelineno-25-87"></a><span class="k">esac</span>
</span><span id="__span-25-88"><a id="__codelineno-25-88" name="__codelineno-25-88" href="#__codelineno-25-88"></a>
</span><span id="__span-25-89"><a id="__codelineno-25-89" name="__codelineno-25-89" href="#__codelineno-25-89"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Build completed!&quot;</span>
</span></code></pre></div>
<h2 id="implementation-phases">üéØ Implementation Phases<a class="headerlink" href="#implementation-phases" title="Permanent link">&para;</a></h2>
<h3 id="phase-1-database-core-api-week-1-2">Phase 1: Database &amp; Core API (Week 1-2)<a class="headerlink" href="#phase-1-database-core-api-week-1-2" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Create database migration for new tables</li>
<li>[ ] Implement artifact management endpoints</li>
<li>[ ] Implement variable management endpoints</li>
<li>[ ] Add unit tests for new models and endpoints</li>
</ul>
<h3 id="phase-2-cli-integration-week-2-3">Phase 2: CLI Integration (Week 2-3)<a class="headerlink" href="#phase-2-cli-integration-week-2-3" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Add artifact commands to CLI</li>
<li>[ ] Add variable commands to CLI</li>
<li>[ ] Add resume-context command to CLI</li>
<li>[ ] Update CLI documentation</li>
</ul>
<h3 id="phase-3-resume-api-week-3-4">Phase 3: Resume API (Week 3-4)<a class="headerlink" href="#phase-3-resume-api-week-3-4" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Implement resume request endpoints</li>
<li>[ ] Implement resumable state configuration</li>
<li>[ ] Add resume-context aggregation logic</li>
<li>[ ] Add integration tests</li>
</ul>
<h3 id="phase-4-orchestrator-service-week-4-6">Phase 4: Orchestrator Service (Week 4-6)<a class="headerlink" href="#phase-4-orchestrator-service-week-4-6" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Build webhook handler</li>
<li>[ ] Implement resume queue</li>
<li>[ ] Build job triggers for Concourse/Jenkins</li>
<li>[ ] Add status monitoring</li>
<li>[ ] Deploy as separate service</li>
</ul>
<h3 id="phase-5-example-scripts-documentation-week-6-7">Phase 5: Example Scripts &amp; Documentation (Week 6-7)<a class="headerlink" href="#phase-5-example-scripts-documentation-week-6-7" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Create example build scripts</li>
<li>[ ] Create example resume scripts</li>
<li>[ ] Write integration guide</li>
<li>[ ] Create video walkthrough</li>
</ul>
<h3 id="phase-6-production-hardening-week-7-8">Phase 6: Production Hardening (Week 7-8)<a class="headerlink" href="#phase-6-production-hardening-week-7-8" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Add monitoring and alerting</li>
<li>[ ] Performance testing with large builds</li>
<li>[ ] Security audit</li>
<li>[ ] Production deployment guide</li>
</ul>
<h2 id="example-scenarios">üîç Example Scenarios<a class="headerlink" href="#example-scenarios" title="Permanent link">&para;</a></h2>
<h3 id="scenario-1-network-timeout-during-package-installation">Scenario 1: Network Timeout During Package Installation<a class="headerlink" href="#scenario-1-network-timeout-during-package-installation" title="Permanent link">&para;</a></h3>
<p><strong>Initial Build:</strong>
- State 0-15: Success (prep work)
- State 20: FAIL (network timeout installing packages)</p>
<p><strong>Resume Flow:</strong>
1. Orchestrator detects failure at state 20
2. Queries API for last successful state (15)
3. Gets artifact from state 15 (base VM snapshot)
4. Triggers new job with:
   - <code>BUILD_ID</code> (same as original)
   - <code>RESUME_MODE=true</code>
   - <code>RESUME_FROM_STATE=20</code>
5. New job:
   - Restores snapshot from state 15
   - Skips states 0-15
   - Retries state 20
   - Continues to completion</p>
<p><strong>Time Saved:</strong> 15 minutes (prep) + 5 minutes (VM creation) = 20 minutes</p>
<h3 id="scenario-2-configuration-error-at-state-60">Scenario 2: Configuration Error at State 60<a class="headerlink" href="#scenario-2-configuration-error-at-state-60" title="Permanent link">&para;</a></h3>
<p><strong>Initial Build:</strong>
- States 0-55: Success (VM built, packages installed)
- State 60: FAIL (Ansible configuration error)</p>
<p><strong>Resume Flow:</strong>
1. Engineer fixes Ansible playbook
2. Manually requests resume via CLI:
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>bldst<span class="w"> </span>build<span class="w"> </span>resume<span class="w"> </span>build-xyz<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span>--from-state<span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span>--reason<span class="w"> </span><span class="s2">&quot;Fixed Ansible syntax error&quot;</span>
</span></code></pre></div>
3. Orchestrator triggers job with resume params
4. Job restores from snapshot at state 55
5. Reruns state 60 with fixed playbook
6. Continues to completion</p>
<p><strong>Time Saved:</strong> ~40 minutes (all previous states)</p>
<h3 id="scenario-3-quota-limit-during-ami-registration">Scenario 3: Quota Limit During AMI Registration<a class="headerlink" href="#scenario-3-quota-limit-during-ami-registration" title="Permanent link">&para;</a></h3>
<p><strong>Initial Build:</strong>
- States 0-90: Success (VM fully built and tested)
- State 95: FAIL (AWS AMI quota exceeded)</p>
<p><strong>Resume Flow:</strong>
1. Ops team increases AMI quota
2. Build auto-resumes after 1 hour (configurable)
3. Job gets snapshot from state 90
4. Skips to state 95 (AMI registration)
5. Successfully registers AMI
6. Complete</p>
<p><strong>Time Saved:</strong> ~60 minutes (entire build except final step)</p>
<h2 id="success-metrics">üìà Success Metrics<a class="headerlink" href="#success-metrics" title="Permanent link">&para;</a></h2>
<h3 id="metrics-to-track">Metrics to Track<a class="headerlink" href="#metrics-to-track" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Resume Success Rate</strong></li>
<li>% of resumes that complete successfully</li>
<li>
<p>Target: &gt;90%</p>
</li>
<li>
<p><strong>Time Savings</strong></p>
</li>
<li>Average time saved per resume</li>
<li>Total hours saved per month</li>
<li>
<p>Target: 20+ hours/month</p>
</li>
<li>
<p><strong>Build Recovery Rate</strong></p>
</li>
<li>% of failed builds successfully resumed</li>
<li>
<p>Target: &gt;80%</p>
</li>
<li>
<p><strong>Artifact Storage</strong></p>
</li>
<li>Total storage used for artifacts</li>
<li>Storage cost per build</li>
<li>
<p>Cleanup effectiveness</p>
</li>
<li>
<p><strong>Resume Latency</strong></p>
</li>
<li>Time from failure to resume trigger</li>
<li>Time from resume trigger to job start</li>
<li>Target: &lt;5 minutes</li>
</ol>
<h3 id="api-metrics-endpoints">API Metrics Endpoints<a class="headerlink" href="#api-metrics-endpoints" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Resume statistics</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>GET<span class="w"> </span>/metrics/resumes/stats
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="c1"># Time savings</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>GET<span class="w"> </span>/metrics/resumes/time-saved?period<span class="o">=</span>30d
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="c1"># Storage usage</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>GET<span class="w"> </span>/metrics/artifacts/storage-usage
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="c1"># Success rates</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>GET<span class="w"> </span>/metrics/builds/resume-success-rate?period<span class="o">=</span>7d
</span></code></pre></div>
<h2 id="design-decisions-trade-offs">ü§î Design Decisions &amp; Trade-offs<a class="headerlink" href="#design-decisions-trade-offs" title="Permanent link">&para;</a></h2>
<h3 id="1-artifact-storage-strategy">1. Artifact Storage Strategy<a class="headerlink" href="#1-artifact-storage-strategy" title="Permanent link">&para;</a></h3>
<p><strong>Decision:</strong> Store artifact metadata in database, actual files in cloud storage</p>
<p><strong>Rationale:</strong>
- Database stores paths, checksums, and metadata
- Actual artifacts in S3/Azure/GCP for scalability
- Deduplication happens at storage layer
- Easy to implement cleanup policies</p>
<p><strong>Trade-offs:</strong>
- Additional storage costs
- Need to manage lifecycle policies
- Network transfer time on resume</p>
<h3 id="2-state-granularity">2. State Granularity<a class="headerlink" href="#2-state-granularity" title="Permanent link">&para;</a></h3>
<p><strong>Decision:</strong> Not all states need to be resumable</p>
<p><strong>Rationale:</strong>
- Quick states (&lt;5 min) can just re-run
- Focus on long-running states (&gt;10 min)
- Reduces artifact storage costs
- Simpler resume logic</p>
<p><strong>Trade-offs:</strong>
- Some time wasted re-running quick states
- Need clear documentation on which states are resumable</p>
<h3 id="3-orchestrator-as-separate-service">3. Orchestrator as Separate Service<a class="headerlink" href="#3-orchestrator-as-separate-service" title="Permanent link">&para;</a></h3>
<p><strong>Decision:</strong> Build orchestrator as independent service</p>
<p><strong>Rationale:</strong>
- Can scale independently
- Doesn't affect API availability
- Can support multiple CI/CD platforms
- Easier to deploy in different environments</p>
<p><strong>Trade-offs:</strong>
- Another service to maintain
- Additional deployment complexity
- Need message queue/webhooks for communication</p>
<h3 id="4-checksum-verification">4. Checksum Verification<a class="headerlink" href="#4-checksum-verification" title="Permanent link">&para;</a></h3>
<p><strong>Decision:</strong> Store SHA256 checksums for all artifacts</p>
<p><strong>Rationale:</strong>
- Detect corrupted artifacts before resume
- Security benefit (detect tampering)
- Relatively fast to compute</p>
<p><strong>Trade-offs:</strong>
- CPU cost to calculate checksums
- Storage for checksum values
- Resume fails if checksum mismatch</p>
<h3 id="5-variable-storage">5. Variable Storage<a class="headerlink" href="#5-variable-storage" title="Permanent link">&para;</a></h3>
<p><strong>Decision:</strong> Store all variables in database, not as artifact files</p>
<p><strong>Rationale:</strong>
- Fast access (no file download)
- Easy to query and update
- Support for sensitive values (encryption)
- Version history built-in</p>
<p><strong>Trade-offs:</strong>
- Limited to simple key-value pairs
- Large values (&gt;1MB) need special handling
- Can't easily restore from file backup</p>
<h2 id="next-steps">üöÄ Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Review this design document</strong> with team</li>
<li><strong>Prioritize use cases</strong> (which types of builds benefit most?)</li>
<li><strong>Choose initial CI/CD platform</strong> (Concourse? Jenkins?)</li>
<li><strong>Define resumable states</strong> for pilot project</li>
<li><strong>Start Phase 1 implementation</strong> (database schema)</li>
</ol>
<h2 id="references">üìö References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://fastapi.tiangolo.com/">FastAPI Documentation</a></li>
<li><a href="https://www.packer.io/docs/builders">Packer Build Artifacts</a></li>
<li><a href="https://concourse-ci.org/resources.html">Concourse Resources</a></li>
<li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSSnapshots.html">AWS EC2 Snapshots</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/managed-disks-overview">Azure Managed Disks</a></li>
</ul>
<hr />
<p><strong>Document Version:</strong> 1.0<br />
<strong>Last Updated:</strong> February 14, 2026<br />
<strong>Status:</strong> Design/Planning Phase<br />
<strong>Next Review:</strong> After team feedback</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/VirtuallyScott/state-builds" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "toc.follow", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f13b1293.min.js"></script>
      
    
  </body>
</html>